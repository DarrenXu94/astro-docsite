---
import MainLayout from "../../layouts/MainLayout.astro";
import { getAllPagesWithSlugs } from "../../lib/api";

import Tabs from "../../components/Tabs/Tabs.astro";

import showdown from "showdown";
const converter = new showdown.Converter();

export async function getStaticPaths() {
  const pagesWithSlugs = await getAllPagesWithSlugs();
  return pagesWithSlugs.reduce((acc, component) => {
    const list = [...acc];
    list.push({
      params: { slug: component.attributes.Page.title, subdir: "demo" },
      props: { component },
    });

    list.push({
      params: { slug: component.attributes.Page.title, subdir: "design" },
      props: { component },
    });
    return list;
  }, []);
}

const { component } = Astro.props;
const { attributes } = component;
const page = attributes.Page;

const { subdir } = Astro.params;

const frontmatter = {
  title: page.title,
};

const allTabs = ["demo", "design"];
const headings = [];
---

<MainLayout {frontmatter} {headings}>
  <Tabs {allTabs} active={subdir} {component} />
  <article style="white-space: pre-line;">
    <Fragment set:html={converter.makeHtml(attributes[subdir])} />
  </article>
  <a href={page.link}>Go to component</a>
  <iframe class="fullHeight" src={page.link} width="100%" frameborder="0"
  ></iframe>
</MainLayout>

<style>
  .fullHeight {
    height: 100vh;
  }
</style>
